# CLA Assistant - Automated Contributor License Agreement signing
#
# SETUP REQUIRED:
# This workflow requires a Personal Access Token (PAT) stored as CLA_TOKEN secret.
#
# To create and configure:
# 1. Go to GitHub → Settings → Developer settings → Personal access tokens → Fine-grained tokens
# 2. Create token with:
#    - Repository access: k8s-ephemeral-environments
#    - Permissions: Contents (Read/Write), Pull requests (Read/Write)
# 3. Add as repository secret: Settings → Secrets → Actions → New secret → CLA_TOKEN
#
# See docs/guides/licensing.md for more details.

name: CLA Assistant

on:
  issue_comment:
    types: [created]
  pull_request_target:
    types: [opened, closed, synchronize]

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  cla:
    runs-on: ubuntu-latest
    if: |
      (github.event.comment.body == 'recheck' ||
       github.event.comment.body == 'I have read the CLA Document and I hereby sign the CLA') ||
      github.event_name == 'pull_request_target'
    steps:
      - name: CLA Assistant
        uses: contributor-assistant/github-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_ACCESS_TOKEN: ${{ secrets.CLA_TOKEN }}
        with:
          path-to-signatures: 'signatures/cla.json'
          path-to-document: 'https://github.com/koder-cat/k8s-ephemeral-environments/blob/main/CLA.md'
          branch: 'main'
          allowlist: 'bot*,dependabot*,dependabot[bot],github-actions[bot],renovate[bot]'
          remote-organization-name: koder-cat
          remote-repository-name: k8s-ephemeral-environments
          custom-notsigned-prcomment: |
            Thank you for your contribution! Before we can merge this PR, you need to sign our Contributor License Agreement (CLA).

            **To sign the CLA**, please comment on this PR with exactly:
            ```
            I have read the CLA Document and I hereby sign the CLA
            ```

            This is a one-time process. Once signed, you won't need to sign again for future contributions.

            **Why a CLA?** This project uses dual licensing (AGPL-3.0 + Commercial). The CLA ensures we can maintain both licensing options. You retain all rights to your contributions.

            Read the full [CLA](https://github.com/koder-cat/k8s-ephemeral-environments/blob/main/CLA.md) | [Licensing FAQ](https://github.com/koder-cat/k8s-ephemeral-environments/blob/main/LICENSE-FAQ.md)
          custom-pr-sign-comment: 'I have read the CLA Document and I hereby sign the CLA'
          lock-pullrequest-aftermerge: false
