# PR Environment Workflow - Dogfooding Edition
#
# This workflow uses the reusable workflow from this same repository,
# demonstrating how external repositories should integrate with k8s-ee.
# Configuration is read from k8s-ee.yaml in the repository root.
#
# For external repositories, change the workflow reference to:
#   uses: genesluna/k8s-ephemeral-environments/.github/workflows/pr-environment-reusable.yml@main

name: PR Environment

on:
  pull_request:
    types: [opened, reopened, synchronize, closed]

# Prevent concurrent runs for the same PR
concurrency:
  group: pr-env-${{ github.event.pull_request.number }}
  cancel-in-progress: false

# Permissions required by the reusable workflow
permissions:
  contents: read
  packages: write
  pull-requests: write
  security-events: write

jobs:
  pr-environment:
    uses: ./.github/workflows/pr-environment-reusable.yml
    with:
      pr-number: ${{ github.event.pull_request.number }}
      pr-action: ${{ github.event.action }}
      head-sha: ${{ github.event.pull_request.head.sha }}
      head-ref: ${{ github.head_ref }}
      repository: ${{ github.repository }}
    secrets: inherit
