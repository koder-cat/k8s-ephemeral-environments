# yaml-language-server: $schema=https://raw.githubusercontent.com/genesluna/k8s-ephemeral-environments/main/.github/actions/validate-config/schema.json

# k8s-ee.yaml - Ephemeral PR environment configuration
# This repository dogfoods its own platform (demo-app uses NestJS with PostgreSQL)
#
# See docs/guides/k8s-ee-config-reference.md for all available options

# Project identifier - used for namespace naming (k8s-ee-pr-{number})
# and preview URL generation ({projectId}-pr-{number}.k8s-ee.genesluna.dev)
projectId: k8s-ee

# Application configuration
app:
  port: 3000                 # Container port the app listens on
  healthPath: /api/health    # Liveness/readiness probe endpoint
  metricsPath: /metrics      # Prometheus metrics endpoint (optional)

# Image build configuration (paths relative to repo root)
image:
  context: ./demo-app        # Docker build context directory
  dockerfile: Dockerfile     # Dockerfile path within context

# Database configuration - enables PostgreSQL for this environment
# Connection string injected as DATABASE_URL environment variable
# Schema is managed by Drizzle ORM migrations at app startup (not bootstrap SQL)
databases:
  postgresql:
    enabled: true
  mongodb:
    enabled: true  # Activity audit logging with 7-day TTL
  redis:
    enabled: true  # API response caching and rate limiting
  minio:
    enabled: true  # S3-compatible file storage

# Enable Prometheus metrics scraping via ServiceMonitor
metrics:
  enabled: true
  interval: 30s              # Scrape interval
